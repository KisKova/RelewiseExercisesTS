!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Relewise={})}(this,(function(e){"use strict";function t(e,t,r,i){return new(r||(r=Promise))((function(n,s){function a(e){try{o(i.next(e))}catch(e){s(e)}}function u(e){try{o(i.throw(e))}catch(e){s(e)}}function o(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,u)}o((i=i.apply(e,t||[])).next())}))}var r="client@2.0.0";class i extends Error{constructor(e,t){super(e),this._details=t}get details(){return this._details}}class n{constructor(e,t,r){if(this.datasetId=e,this.apiKey=t,this._serverUrl="https://api.relewise.com",this._urlPath="v1",!e)throw new Error("Dataset id cannot be null or empty. Please contact Relewise if you don't have an account already or would like a free demo license");if(!t)throw new Error("API Key secret cannot be null or empty. Please contact Relewise support if you don't know the apiKeySecret for your datasetId.");this._apiKeyHeader=`APIKey ${this.apiKey}`,(null==r?void 0:r.serverUrl)&&(this._serverUrl=r.serverUrl)}get serverUrl(){return this._serverUrl}request(e,n,s){return t(this,void 0,void 0,(function*(){const t=this.createRequestUrl(this._serverUrl,this.datasetId,this._urlPath,e),a=yield fetch(t,{method:"POST",headers:{Authorization:this._apiKeyHeader,"Content-Type":"application/json","X-Relewise-Version":r},body:JSON.stringify(n),signal:null==s?void 0:s.abortSignal,cache:"no-cache"});if(!a.ok){let e=null;try{e=yield a.json()}catch(e){}const t=(null==e?void 0:e.detail)?`Details: ${e.detail}\n`:"";throw new i(`Error when calling the Relewise API.\n\nTitle: ${a.statusText}\nStatus: ${a.status}\n${t}\nRead more in the details property if there is error response or look in the network tab.`,e)}try{return yield a.json()}catch(e){return}}))}createRequestUrl(e,...t){const r=t.join("/");return e.endsWith("/")?e.concat(r):e.concat("/",r)}}e.ProblemDetailsError=i,e.RelewiseClient=n,e.Tracker=class extends n{constructor(e,t,r){super(e,t,r),this.datasetId=e,this.apiKey=t}trackOrder({user:e,subtotal:r,orderNumber:i,lineItems:n,cartName:s="default",trackingNumber:a,data:u},o){return t(this,void 0,void 0,(function*(){return this.request("TrackOrderRequest",{$type:"Relewise.Client.Requests.Tracking.TrackOrderRequest, Relewise.Client",order:{$type:"Relewise.Client.DataTypes.Order, Relewise.Client",lineItems:n.map((e=>Object.assign(Object.assign({product:{id:e.productId}},e.variantId&&{variant:{id:e.variantId}}),{lineTotal:e.lineTotal,quantity:e.quantity,data:e.data}))),subtotal:{amount:r.amount,currency:{value:r.currency}},orderNumber:i,trackingNumber:a,cartName:s,data:u,user:e}},o)}))}trackCart({user:e,subtotal:r,lineItems:i,data:n,cartName:s="default"},a){return t(this,void 0,void 0,(function*(){return this.request("TrackCartRequest",{$type:"Relewise.Client.Requests.Tracking.TrackCartRequest, Relewise.Client",cart:{$type:"Relewise.Client.DataTypes.Cart, Relewise.Client",lineItems:i.map((e=>Object.assign(Object.assign({product:{id:e.productId}},e.variantId&&{variant:{id:e.variantId}}),{lineTotal:e.lineTotal,quantity:e.quantity,data:e.data}))),subtotal:{amount:r.amount,currency:{value:r.currency}},name:s,user:e,data:n}},a)}))}trackProductView({productId:e,variantId:r,user:i},n){return t(this,void 0,void 0,(function*(){return this.request("TrackProductViewRequest",{$type:"Relewise.Client.Requests.Tracking.TrackProductViewRequest, Relewise.Client",productView:Object.assign(Object.assign({$type:"Relewise.Client.DataTypes.ProductView, Relewise.Client",product:{id:e}},r&&{variant:{id:r}}),{user:i})},n)}))}trackProductCategoryView({idPath:e,user:r},i){return t(this,void 0,void 0,(function*(){return this.request("TrackProductCategoryViewRequest",{$type:"Relewise.Client.Requests.Tracking.TrackProductCategoryViewRequest, Relewise.Client",productCategoryView:{$type:"Relewise.Client.DataTypes.ProductCategoryView, Relewise.Client",idPath:e,user:r}},i)}))}trackContentView({contentId:e,user:r},i){return t(this,void 0,void 0,(function*(){return this.request("TrackContentViewRequest",{$type:"Relewise.Client.Requests.Tracking.TrackContentViewRequest, Relewise.Client",contentView:{$type:"Relewise.Client.DataTypes.ContentView, Relewise.Client",content:{id:e},user:r}},i)}))}trackContentCategoryView({idPath:e,user:r},i){return t(this,void 0,void 0,(function*(){return this.request("TrackContentCategoryViewRequest",{$type:"Relewise.Client.Requests.Tracking.TrackContentCategoryViewRequest, Relewise.Client",contentCategoryView:{$type:"Relewise.Client.DataTypes.ContentCategoryView, Relewise.Client",idPath:e,user:r}},i)}))}trackBrandView({brandId:e,user:r},i){return t(this,void 0,void 0,(function*(){return this.request("TrackBrandViewRequest",{$type:"Relewise.Client.Requests.Tracking.TrackBrandViewRequest, Relewise.Client",brandView:{$type:"Relewise.Client.DataTypes.BrandView, Relewise.Client",brand:{id:e},user:r}},i)}))}trackSearchTerm({term:e,language:r,user:i},n){return t(this,void 0,void 0,(function*(){return this.request("TrackSearchTermRequest",{$type:"Relewise.Client.Requests.Tracking.TrackSearchTermRequest, Relewise.Client",searchTerm:{$type:"Relewise.Client.DataTypes.SearchTerm, Relewise.Client",language:{value:r},term:e,user:i}},n)}))}trackUserUpdate({user:e,updateKind:r="UpdateAndAppend"},i){return t(this,void 0,void 0,(function*(){return this.request("TrackUserUpdateRequest",{$type:"Relewise.Client.Requests.Tracking.TrackUserUpdateRequest, Relewise.Client",userUpdate:{$type:"Relewise.Client.DataTypes.UserUpdate, Relewise.Client",user:e,kind:r}},i)}))}},e.UserFactory=class{static anonymous(e){return Object.assign({},e)}static byAuthenticatedId(e,t,r){return Object.assign(Object.assign({authenticatedId:e},t&&{temporaryId:t}),r)}static byTemporaryId(e,t){return Object.assign(Object.assign({},t),{temporaryId:e})}static byIdentifier(e,t,r){return Object.assign(Object.assign({},r),{identifiers:{[e]:t}})}static byIdentifiers(e,t){return Object.assign({identifiers:e},t)}static byEmail(e,t){return Object.assign({email:e},t)}static byFingerprint(e,t){return Object.assign({fingerprint:e},t)}},Object.defineProperty(e,"__esModule",{value:!0})}));
